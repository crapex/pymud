# 界面和主要操作

## 界面

下图是主要界面，用1-7标注出7个主要内容，含义如下：

1. 菜单栏，可以鼠标操作（手机上是触控），目前只有3个1级菜单
2. 多会话的显示和切换标签。多个会话时，每一个会话的名称会在此处，灰底亮字的是当前会话。颜色为绿色的表示当前会话处于连接状态，未处于连接状态的为白色（灰色）。可以直接单击会话名称切换会话。键盘的话，Ctrl+左右箭头可以切换
3. 中间分隔线。当向上滚动或翻页的时候，会产生中间分隔线，此时上半部分不再滚动，下半部分持续滚动显示最新的消息。取消分隔的话，可以向下滚动到底，或者Ctrl-Z快捷键取消（仿zmud操作）。上下翻页只能使用鼠标滚轮，或者PageUp\PageDown按键。鼠标滚轮是一次一行，键盘是一次一页。
4. 状态窗口。可以使用函数自定义状态窗口显示内容，图例是我自己定义的状态窗口显示内容。
5. 命令输入行。命令输入行支持历史记录、以及基于历史记录的自动建议和自动完成。键盘上下方向键可以在历史记录中选择，键盘右键实现历史记录建议的自动完成。比如前面输入过ask pu about job，后面输入ask的时候，后面的 pu about job会以灰色显示（表示自动建议），只需键盘右箭头，即可完成输入。
6. 状态栏，显示状态信息，目前只有会话切换、复制内容的信息会显示，可以通过app.set_status来设置显示的文字
7. 状态栏（右），显示连接状态和连接时间。因为基于控制台的ui不是时刻刷新，因此链接的时间有时会滞后显示，看上去就是秒在跳动，不影响时间记录。

![main_ui](_static/main_ui.png)

## 会话与连接管理

连接到服务器有以下四种方式：
+ 使用“世界”->“创建新会话菜单”。如果是连接北侠，修改会话名称为你想要的即可（不改也可以连接）。
+ 使用命令行命令：在命令行内输入：
```
#session {session_name} {host} {port} {encoding}
```
大括号内容为，分别代表会话名称、服务器地址、端口、编码方式（编码方式可不指定，此时默认为utf-8编码）。例如，使用下列命令可以创建一个名为newstart的会话并连接到北侠。
```
#session newstart mud.pkuxkx.net 8081
```

+ 在settings.py中加入常用的角色会话。此时会自动生成菜单，鼠标选择对应的菜单可自动连接到会话。
```Python
    sessions = {
        "pkuxkx" : {                                                  # 一个服务器作为一个一级菜单项，所有角色放在下面
            "host" : "mud.pkuxkx.net",                                # 服务器地址
            "port" : "8081",                                          # 服务器端口
            "encoding" : "utf8",                                      # 服务器编码
            "autologin" : "{0};{1}",                                  # 自动登录命令，此处{0}、{1}是两个参数，实际运用时会自动指代下面的角色id和密码进行替换。分号指示两次命令输入。当不使用自动登录时，该参数可以设置为None，或空字符串""
            "default_script": "pkuxkx",                               # 角色登录后默认加载的脚本（省略.py扩展名）。此处指默认加载当前目录下的pkuxkx.py文件
            "chars" : {
                "newstart" : ["newstart", "mypassword"],              # 创建的角色菜单，会话名、角色ID、角色密码
                "your_session"  :["char_id", "char_pass"],            # 可保存多个角色，使用,隔开，即在字典中使用多个key。
            }
        },
        "evennia" : {                                                 # 也可以创建多个服务器的菜单，按规则依次填写即可。
            "host" : "192.168.220.128",
            "port" : "4000",
            "encoding" : "utf8",
            "autologin" : "connect {0} {1}",
            "default_script": None,
            "chars" : {
                "evennia"   : ("admin", "admin"),
            }
        }
    }
```
+ 在当前目录下新建pymud.cfg文件，并使用json格式按settings.py中样式覆盖sessions等部分，也可以覆盖settings.py中的其他设置。如（注：此处json文件不支持注释）：
```
 {
    "client" : {          
        "status_height"     : 4,        
        "interval"          : 10,                   
        "auto_connect"      : 1,      
        "echo_input"        : 0,     
        "status_display"    : 1
    },

    "sessions": {
        "pkuxkx" : {
            "host" : "mud.pkuxkx.net",
            "port" : "8081",
            "encoding" : "utf8",
            "autologin" : "{0};{1}",
            "default_script": "myscript",
            "chars" : {
                "newstart" : ["newstart", "password"],
                "your_session" : ["char_id", "password"]
            }
        }
    }
 }
```

+ 可以支持同时打开多个会话，此时在顶部中央会显示不同的会话名称和当前会话。可以使用鼠标切换会话，或者使用快捷键Ctrl+左右箭头实现会话向左和向右切换。
+ 当使用quit命令退出北侠账号、或者由于网络异常，或者操作菜单“会话”->“断开连接”后，服务器会断开连接，但此时会话窗口并不会关闭。在这种情况下，可以使用命令#connect（或缩写#con）重新连接到服务器。也可以使用菜单“会话”->“连接/重新连接到服务器”执行同样功能。
+ 关闭会话窗口可以使用#close命令。也可以使用菜单“会话”->“关闭当前会话”进行关闭。